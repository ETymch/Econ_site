---
title: "Лекция 0"
author: "Е. Тымченко"
date: 2023-04-18
categories: ["R"]
tags: ["Первые шаги"]
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(palmerpenguins) # need to install
library(broom) 
library(skimr) # need to install
library(bslib) # need to install
library(knitr)
library(DT)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

# Основы **R** 

Это мой первый опыт в создании и редактировании сайта. В ближайшее время я буду вносить изменения в формат и в содержание постов, но пока так.

<center>

![Надеюсь, у вас хорошее настроение.](https://github.com/ETymch/Econometrics_2023/blob/d4b9c5d0f14136c1a35aebfe5dddf1265cd323a5/Pics/dancing.gif?raw=true)

</center>

В курсе мы будем использовать язык **R**. Он относительно простой и удобный, а главное - бесплатный! Если вы его ещё не установили - [самое время это сделать по ссылке!](https://cran.r-project.org/bin/windows/base/) После установки **R** необходимо поставить экосистему [**RStudio** - она очень удобная и сделает знакомство с **R** наиболее безболезненным](https://posit.co/downloads/). Когда вы впервые запустите **RStudio**, создайте рабочее пространство, кликните на верхней панели `Session` -> `Set Working Directory` -> `Choose Directory`. Теперь ваш код и файлы с данными для этого курса никуда не потеряются. Самое время начать знакомство с **R**!

Обычно в начале требуется какое-то вступительное слово, но у меня его нет. Поэтому начнём мы с анекдота от искусственного интеллекта: 

> Однажды на конференции по математической статистике один из участников гордо заявил, что его метод имеет "p-value" на уровне значимости меньше 0,0001. Внезапно из зала послышался голос другого участника, который спросил: "А что такое p-value?" Первый участник перестал уверенно улыбаться и начал объяснять сущность этого статистического понятия. Его описание было настолько запутанным и непонятным, что зал начал смеяться. Второй участник поднял руку и сказал: "Спасибо за объяснение, теперь я понимаю, что p-value - это как раз то, чего я не хочу получить в своих экспериментах!"

> Анекдот про эконометрику от Chat GPT.

Сегодня познакомимся с:

* `Tidyverse` - пожалуй, самой удобной на сегодня библиотекой для манипуляции данными
* `Stats` - уже включённой в **R** библиотекой для статистического моделирования

Давайте загрузим библиотеку `Tidyverse`:

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
```

## Векторы и таблицы

Чтобы задать вектор в **R** мы используем функцию `c()`. Например, у нас есть три друга: Боря, Настя и Алина. Зададим вектор друзей:

```{r}
friends <- c('Боря', 'Настя', 'Алина')
```

Давайте посмотрим на этот объект внимательно:

```{r}
str(friends)
```

Сообщение выше значит, что `friends` - это вектор с 3-мя значениями в текстовом формате.

Допустим, мы хотим выбрать одного друга из нашего вектора друзей. В **R**, как и во многих других языках, это делается через индекс в скобочках `[]`. Допустим, мы хотим выбрать второй элемент:

```{r}
friends[2]
```
Также мы можем создать другие векторы:

```{r}
age <- c(22, 25, 24)
fav_movie <- c('Убить Билла', 'Робокоп', 'Броненосец Потёмкин')
dota_hours_played <- c(0, 2, 15000)
```

Из этих векторов мы можем собрать табличку - `data.frame`. Мы будем очень много работать с ними в курсе.

```{r}
data.frame(Имя = friends,
                   Возраст = age,
                   `Любимый фильм` = fav_movie, # я использую ``, чтобы задать название переменной с пробелом. Обчыно мы пишем _ вместо пробела, но в образовательных целях я сейчас написал так.
                   `Наиграно часов в Доту` = dota_hours_played,
                   check.names = F # опция, которая не исправляет имена
                   )
```

На данный момент эта табличка не сохранена у нас в памяти, потому что мы не связали с ней никакой объект. Добавим в неё логическую переменную `Геймер` и сохраним в память под именем `data`:

```{r}
data <- data.frame(Имя = friends,
                   Возраст = age,
                   `Любимый фильм` = fav_movie,
                   `Наиграно часов в Доту` = dota_hours_played,
                   check.names = F # опция, которая не исправляет имена
                   ) %>%
  mutate(Геймер = ifelse(`Наиграно часов в Доту` >= 1000, T, F)
  )

data
```

Сейчас мы использовали две новые функции:
* `mutate()` - создаёт или изменяет уже созданные переменные. Подробнее - в документации: `?mutate()`
* `ifelse()` краткое написание логического утверждения. В нашем случае мы задали условие, если переменная `Наиграно часов в Доту >= 1000`, то наш друг - геймер (*и в последний раз мы видели его несколько лет назад*), второй аргумент, `T` - значит `True`, условие выполнено. Иначе - `F` - `False`, наш друг - не геймер.

мы можем выбрать определённый столбец из нашей таблицы, написав `$` после названия таблицы и нажав `Tab`. **R** сам предложит вам столбец на выбор. Например:

```{r}
data$Геймер
```

## Обработка данных:

У нас есть данные по различным сборкам ноутбуков и их ценам. Давайте потренируемся обрабатывать данные этом примере. В будущих лекциях мы построим модель ценообразования на рынке ноутбуков (это поможет нам найти самые недооценённые ноутбуки и сформировать свой высокодоходный портфель ноутбуков)!

```{r}
data <- read.csv('https://raw.githubusercontent.com/ETymch/Econometrics_2023/main/Datasets/laptop_price.csv')
data %>%
  group_by(Company) %>% # Упорядочить таблицу по алфавиту, используя название фирмы изготовителя
  head()
```

Когда мы пишем код в **R** мы часто используем `%>%` - трубочки. Всё просто: допустим мы хотим последовательно применить к объекту несколько функций. Помните, в курсе по математике были вложенные функции $f(g(x))$? Тогда это значило, что к объекту $x$ мы сначала применяли функцию $g$, затем функцию $f$. При помощи `%>%` мы можем написать это так: `x %>% g() %>% f()`. Хороший тон - писать такие функции в столбик - тогда код удобно читать. Если мы захотим последовательно применить много функций (для манипуляции сложным объектом), то код, написанный первым подходом становится нечитаемым. Например: `datatable(head(group_by(Data, Company)))`.

Давайте посмотрим, какие бренды представлены в выборке:

```{r}
data$Company %>%
  as.factor() %>% # меняем тип данных
  plot(main = 'Бренды в выборке')
```

Давайте посмотрим на распределение цен в выборке:

```{r}
data$Price_euros %>%
  hist(main = 'Распределение цен ноутбуков')# Гистограмма
```

На графике заметно, что есть какие-то супердорогие ноутбуки, которые стоят более 4k евро! Давайте посмотрим на них.

```{r}
data %>%
  filter(Price_euros >= 4000) # Выбрать наблюдения на основании критерия
```

### Потренируйтесь:

>
* Какую долю в выборке составляют ноутбуки HP?
* Выберите эти ноутбуки и нарисуйте гистограмму распределения цен.
* Верно ли, что разрешение экрана у ноутбуков ASUS в среднем выше, чем у ноутбуков Dell?

## Оптимизация

В вступительном тесте у вас была задача оптимизации. $$\min_x{(3-3x)^2}$$
Иначе говоря, мы хотим найти такой $x$, чтобы интересующая нас функция $(3-3x)^2$ приняла минимальное значение. Есть несколько способов её решить.

* Из школьного курса мы помним, что $(3-3x)^2$ - вогнутая парабола (с ветками вверх). Значит она имеет 1 решение, догадаться до которого просто, при $x = 1$ функция принимает значение 0.
* Взяв производную, мы найдём точку, в которой касательная к графику параллельна оси функции.
$$[(3-3x)^2]' 
= -12(3-3x)
= 0$$
Следовательно, $x = 1$. Искомая функция принимает значение 1.
* Мы можем быстро запрограммировать этот пример. Помните, в этом курсе использование компьютера поощряется **всегда**. Напишем функцию:
```{r}
f <- function(x){
  (3 - 3*x)^2
}
```
Нарисуем её на промежутке [-5;5]:
```{r}
x = seq(-5, 5, by = 0.01) # вектор от -5 до 5 с шагом 0.01.
plot(x, f(x), col = 'lightblue')
```
Да, очевидно это вогнутая парабола. Найдём минимум:

```{r}
optimize(f, x)
```
Функция принимает минимальное значение 0 при $x = 1$

Мы решили задачу оптимизации!

<center>

![Ура!](https://github.com/ETymch/Econometrics_2023/blob/main/Pics/celebration.gif?raw=true)

</center>

Теперь ваш черёд! Решите аналитически и при помощи **R**, постройте график:
$$\max_x\{3 - 10x - 2x^2\}$$

## Интегрирование:

В курсе нам иногда нужно будет вычислить вероятности различных событий - для этого потребуется взять интеграл. Давайте вспомним, как считать интегралы на примере:

$$F(x) = \int_{-\infty}^{0} e^{2x + 1}dx = \frac{1}{2}e^{2x+1}|^0_{-\infty} = \frac{1}{2}e - 0 = \frac{1}{2}e$$

```{r}
f <- function(x){
  return(exp(2*x+1))
}

integrate(f, -Inf, 0)
```

Если вам нужно взять интеграл аналитически - не нужно вспоминать всю теорию, пользуйтеся языками программирования, например, **Mathematica**.
