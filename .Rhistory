plot.caption = element_markdown(color = "grey65", size = 10,
hjust = .5, vjust = .5, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 35, b = 0)),
plot.title.position = "plot"
)
gc()
library(tidyverse)
library(gggibbous)
library(fiftystater)
library(ggtext)
library(showtext)
font_add_google("Copse", "Copse")
font_add_google("Staatliches", "Staatliches")
font_add_google('Merriweather')
font_add_google('Philosopher')
showtext_auto()
## ggplot theme
theme_set(theme_void(base_family = "Philosopher"))
df <- read_excel('cp_indexes.xls', sheet = 4) %>%
pivot_longer(
cols = c('prod_sh', 'n_prod_sh'),
names_to = 'group_g',
values_to = 'ratio_g'
) %>%
pivot_longer(
cols = c('goods_sh', 'serv_sh'),
names_to = 'gs',
values_to = 'ratio_gs'
) %>%
pivot_longer(cols = c('all', 'goods'),
names_to = 'cats',
values_to = 'vals') %>%
mutate(right = rep(c(T,T,F,F), 224))
df <- df %>%
filter(date >= as.Date('2021-01-01'),
cats  == 'all') %>%
mutate(vals = (vals - 1) * 100)
df %>%
ggplot(aes(x = date, y = vals)) +
geom_line(color = 'grey40', alpha = .4, size = 1.5) +
geom_point(
aes(color = cats),
size = 8.7
) +
geom_moon(
aes(
ratio = ratio_gs,
right = right,
fill = gs
),
color = "transparent",
size = 8
) +
geom_text(
data = df %>%
filter(gs == "serv_sh", group_g == 'prod_sh', date <= as.Date('2023-04-01'), cats  == "all"),
aes(
label = glue::glue("{round(ratio_gs * 100, 0)}%"),
color = cats
),
family = "Philosopher",
fontface = "bold",
size = 3.5,
hjust = -0.55, # right
vjust = 3 # down
) +
annotate(
"text",
x = df$date[109],
y = 15,
label = "Инфляция г/г, %",
family = "Philosopher",
color = "grey40",
size = 4,
lineheight = .8,
hjust = 0,
vjust = 0
) +
coord_cartesian(clip = "off") +
scale_x_continuous(
expand = c(.03, .03),
limits = c(df$date[1]-1, df$date[length(df$date)]+1),
breaks = seq(df$date[1], df$date[length(df$date)], by = 'year')
) +
scale_y_continuous(
expand = c(.05, .05),
breaks = seq(1, 13, by = 3),
labels = glue::glue(" {seq(1, 13, by = 3)}%"),
position = "right"
) +
scale_color_manual(
values = c("grey65", "grey20"),
guide = F
) +
scale_fill_manual(
values = c('#FF85A4', '#972D00'),
#values = c("#FFD54E", "#A80002"),
guide = F
) +
labs(
title = 'Драйверы инфляции: <b style="color:#FF85A4">товары</b> или <b style="color:#972D00">услуги</b>?',
subtitle = 'Впервые за долгое время рост цен в России обусловлен дорожанием <b style="color:#972D00">услуг (88%)</b>, нежели <b style="color:#FF85A4">товаров</b>. Иллюстрация, что <br> российские рынки <b style="color:#FF85A4">товаров</b> реагировали на изменение макроэкономических условий в феврале-марте 2022 г. быстрее, <br> чем рынки <b style="color:#972D00">услуг.</b>.',
caption = 'Е. Тымченко  •  Источник: Росстат'
)  +
theme(
axis.text.x = element_text(color = "grey40", size = 13, face = "bold"),
axis.text.y = element_text(color = "grey40", size = 11, hjust = 0),
panel.grid.major.y = element_line(color = "grey92", size = .5),
plot.background = element_rect(color = "#333333", size = 2, fill = "white"),
plot.margin = margin(20, 50, 20, 60),
plot.title = element_markdown(family = "Merriweather", color = "#333333",
size = 30, face = "bold", hjust = 0.5,
margin = margin(t = 15, b = 10)),
plot.subtitle = element_markdown(color = "grey65", size = 15, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 0, b = -3)),
plot.caption = element_markdown(color = "grey65", size = 10,
hjust = .5, vjust = .5, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 35, b = 0)),
plot.title.position = "plot"
)
df_census_moon %>%
ggplot(aes(year, black)) +
geom_line(
aes(
color = region,
color = after_scale(colorspace::lighten(color, .6, space = "HLS"))
),
size = 2
) +
geom_point(
aes(color = region),
size = 18.7
) +
geom_moon(
aes(
ratio = ratio,
right = right,
fill = group
),
color = "transparent",
size = 17
)
df_census_moon %>%
ggplot(aes(year, black)) +
geom_curve(
data = tibble(
x = c(1820, 1793),
xend = c(1810, 1790),
y = c(1642672, 3.4*10^6),
yend = c(2.9*10^6, 67424),
region = c("South", "Rest")
),
aes(
x = x, xend = xend,
y = y, yend = yend,
color = region
),
curvature = 0.45,
size = .9,
linetype = "dotted"
) +
geom_line(
aes(
color = region,
color = after_scale(colorspace::lighten(color, .6, space = "HLS"))
),
size = 2
) +
geom_point(
aes(color = region),
size = 18.7
) +
geom_moon(
aes(
ratio = ratio,
right = right,
fill = group
),
color = "transparent",
size = 17
) +
geom_text(
data = df_census_moon %>%
filter(group == "free_perc", year < 1870, region == "South"),
aes(
label = glue::glue("{round(ratio * 100, 0)}%"),
color = region
),
family = "Copse",
fontface = "bold",
size = 4,
hjust = 0,
nudge_x = 2.7,
nudge_y = -170000
) +
geom_text(
data = df_census_moon %>%
filter(group == "free_perc", year < 1870, region != "South"),
aes(
label = glue::glue("{round(ratio * 100, 0)}%"),
color = region
),
family = "Copse",
fontface = "bold",
size = 4,
hjust = 0,
nudge_x = 2.3,
nudge_y = 250000
) +
geom_text(
data = df_census_moon %>%
filter(group == "free_perc", year == 1870),
aes(
label = glue::glue("{round(ratio * 100, 0)}%"),
color = region,
vjust = as.numeric(as.factor(region)) - 1
),
family = "Copse",
fontface = "bold",
size = 5.7,
hjust = 0,
nudge_x = 2.7
) +
annotate(
"text",
x = 1877,
y = 5.15*10^6,
label = "        Black\n  Population",
family = "Copse",
color = "grey40",
size = 4.5,
lineheight = .8,
hjust = 0,
vjust = 0
) +
coord_cartesian(clip = "off") +
scale_x_continuous(
expand = c(.03, .03),
limits = c(1789.7, 1877),
breaks = seq(1790, 1870, by = 10)
) +
scale_y_continuous(
expand = c(.05, .05),
breaks = seq(0, 5*10^6, by = 10^6),
labels = c(" 0", glue::glue(" {1:5}M")),
position = "right"
) +
scale_color_manual(
values = c("grey65", "grey20"),
guide = F
) +
scale_fill_manual(
values = c("#FFD54E", "#A80002"),
guide = F
) +
labs(
# text partly from https://www.history.com/news/slavery-profitable-southern-economy
title = 'An Economy Built on <b style="color:#A80002">Slavery</b>—A Future Build on <b style="color:#FFC91B">Freedom</b>?',
subtitle = 'By 1680, property owners in the south of North America began establishing plantation farms for cash crops like tobacco, cotton, and sugar cane—enterprises that required<br>increasing amounts of labor. To meet the need, wealthy planters became slave traders and imported ever more individuals to the colonies, the vast majority from West Africa.<br>While the "Emancipation Proclamation" was made law as of 1863, slave owners in the South, namely Texas, still maintained slavery until <b>June 19<sup>th</sup> 1865</b> when Union soldiers<br>were able to enforce the law abolishing slavery in the region. The graphic below shows the share of <b style="color:#A80002">black people in slavery</b>, <b style="color:#333333">most of them enslaved in the Southern states</b>, and<br><b style="color:#FFC91B">black people living in freedom</b> per decade from 1790 to 1870—the first U.S. census after the Liberation Day known as "Juneteenth".',
caption = '<b style="font-size:20pt;color:#333333;font-family:Staatliches">#JUNETEENTH #BLACKLIVESMATTER</b><br>Graphic: Cédric Scherer  •  Source: U.S. Census Bureau'
)  +
theme(
axis.text.x = element_text(color = "grey40", size = 15, face = "bold"),
axis.text.y = element_text(color = "grey40", size = 11, hjust = 0),
panel.grid.major.y = element_line(color = "grey92", size = .5),
plot.background = element_rect(color = "#333333", size = 2, fill = "white"),
plot.margin = margin(20, 50, 20, 60),
plot.title = element_markdown(family = "Staatliches", color = "#333333",
size = 40, face = "bold",
margin = margin(t = 15, b = 10)),
plot.subtitle = element_markdown(color = "grey65", size = 11, lineheight = 1.5,
margin = margin(t = 0, b = -3)),
plot.caption = element_markdown(color = "grey65", size = 10,
hjust = .5, vjust = .5, lineheight = 1.5,
margin = margin(t = 35, b = 0)),
plot.title.position = "plot"
)
View(df)
df <- read_excel('cp_indexes.xls', sheet = 4) %>%
pivot_longer(
cols = c('prod_sh', 'n_prod_sh'),
names_to = 'group_g',
values_to = 'ratio_g'
) %>%
pivot_longer(
cols = c('goods_sh', 'serv_sh'),
names_to = 'gs',
values_to = 'ratio_gs'
) %>%
pivot_longer(cols = c('all', 'goods'),
names_to = 'cats',
values_to = 'vals') %>%
mutate(right = rep(c(T,T,F,F), 224))
library(readxl)
df <- read_excel('cp_indexes.xls', sheet = 4) %>%
pivot_longer(
cols = c('prod_sh', 'n_prod_sh'),
names_to = 'group_g',
values_to = 'ratio_g'
) %>%
pivot_longer(
cols = c('goods_sh', 'serv_sh'),
names_to = 'gs',
values_to = 'ratio_gs'
) %>%
pivot_longer(cols = c('all', 'goods'),
names_to = 'cats',
values_to = 'vals') %>%
mutate(right = rep(c(T,T,F,F), 224))
df <- df %>%
filter(date >= as.Date('2021-01-01'),
cats  == 'all') %>%
mutate(vals = (vals - 1) * 100)
setwd("C:/Users/evgen/econometrics_2023/GGplot visualizations")
df <- read_excel('cp_indexes.xls', sheet = 4) %>%
pivot_longer(
cols = c('prod_sh', 'n_prod_sh'),
names_to = 'group_g',
values_to = 'ratio_g'
) %>%
pivot_longer(
cols = c('goods_sh', 'serv_sh'),
names_to = 'gs',
values_to = 'ratio_gs'
) %>%
pivot_longer(cols = c('all', 'goods'),
names_to = 'cats',
values_to = 'vals') %>%
mutate(right = rep(c(T,T,F,F), 224))
df <- df %>%
filter(date >= as.Date('2021-01-01'),
cats  == 'all') %>%
mutate(vals = (vals - 1) * 100)
df %>%
ggplot(aes(x = date, y = vals)) +
geom_line(color = 'grey40', alpha = .4, size = 1.5) +
geom_point(
aes(color = cats),
size = 8.7
) +
geom_moon(
aes(
ratio = ratio_gs,
right = right,
fill = gs
),
color = "transparent",
size = 8
) +
geom_text(
data = df %>%
filter(gs == "serv_sh", group_g == 'prod_sh', date <= as.Date('2023-04-01'), cats  == "all"),
aes(
label = glue::glue("{round(ratio_gs * 100, 0)}%"),
color = cats
),
family = "Philosopher",
fontface = "bold",
size = 3.5,
hjust = -0.55, # right
vjust = 3 # down
) +
annotate(
"text",
x = df$date[109],
y = 15,
label = "Инфляция г/г, %",
family = "Philosopher",
color = "grey40",
size = 4,
lineheight = .8,
hjust = 0,
vjust = 0
) +
coord_cartesian(clip = "off") +
scale_x_continuous(
expand = c(.03, .03),
limits = c(df$date[1]-1, df$date[length(df$date)]+1),
breaks = seq(df$date[1], df$date[length(df$date)], by = 'year')
) +
scale_y_continuous(
expand = c(.05, .05),
breaks = seq(1, 13, by = 3),
labels = glue::glue(" {seq(1, 13, by = 3)}%"),
position = "right"
) +
scale_color_manual(
values = c("grey65", "grey20"),
guide = F
) +
scale_fill_manual(
values = c('#FF85A4', '#972D00'),
#values = c("#FFD54E", "#A80002"),
guide = F
) +
labs(
title = 'Драйверы инфляции: <b style="color:#FF85A4">товары</b> или <b style="color:#972D00">услуги</b>?',
subtitle = 'Впервые за долгое время рост цен в России обусловлен дорожанием <b style="color:#972D00">услуг (88%)</b>, нежели <b style="color:#FF85A4">товаров</b>. Иллюстрация, что <br> российские рынки <b style="color:#FF85A4">товаров</b> реагировали на изменение макроэкономических условий в феврале-марте 2022 г. быстрее, <br> чем рынки <b style="color:#972D00">услуг.</b>.',
caption = 'Е. Тымченко  •  Источник: Росстат'
)  +
theme(
axis.text.x = element_text(color = "grey40", size = 13, face = "bold"),
axis.text.y = element_text(color = "grey40", size = 11, hjust = 0),
panel.grid.major.y = element_line(color = "grey92", size = .5),
plot.background = element_rect(color = "#333333", size = 2, fill = "white"),
plot.margin = margin(20, 50, 20, 60),
plot.title = element_markdown(family = "Merriweather", color = "#333333",
size = 30, face = "bold", hjust = 0.5,
margin = margin(t = 15, b = 10)),
plot.subtitle = element_markdown(color = "grey65", size = 15, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 0, b = -3)),
plot.caption = element_markdown(color = "grey65", size = 10,
hjust = .5, vjust = .5, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 35, b = 0)),
plot.title.position = "plot"
)
ggsave(here::here("inflation_2.pdf"),
width = 13.8, height = 10.5, device = cairo_pdf)
pdftools::pdf_convert(here::here("inflation_2.pdf"),
format = "png", dpi = 500)
blogdown:::preview_site()
setwd("C:/Users/evgen/econometrics_2023/GGplot visualizations")
df %>%
ggplot(aes(x = date, y = vals)) +
geom_line(color = 'grey40', alpha = .4, size = 1.5) +
geom_point(
aes(color = cats),
size = 8.7
) +
geom_moon(
aes(
ratio = ratio_gs,
right = right,
fill = gs
),
color = "transparent",
size = 8
) +
geom_text(
data = df %>%
filter(gs == "serv_sh", group_g == 'prod_sh', date <= as.Date('2023-04-01'), cats  == "all"),
aes(
label = glue::glue("{round(ratio_gs * 100, 0)}%"),
color = cats
),
family = "Philosopher",
fontface = "bold",
size = 3.5,
hjust = -0.55, # right
vjust = 3 # down
) +
annotate(
"text",
x = df$date[109],
y = 15,
label = "Инфляция г/г, %",
family = "Philosopher",
color = "grey40",
size = 4,
lineheight = .8,
hjust = 0,
vjust = 0
) +
coord_cartesian(clip = "off") +
scale_x_continuous(
expand = c(.03, .03),
limits = c(df$date[1]-1, df$date[length(df$date)]+1),
breaks = seq(df$date[1], df$date[length(df$date)], by = 'year')
) +
scale_y_continuous(
expand = c(.05, .05),
breaks = seq(1, 13, by = 3),
labels = glue::glue(" {seq(1, 13, by = 3)}%"),
position = "right"
) +
scale_color_manual(
values = c("grey65", "grey20"),
guide = F
) +
scale_fill_manual(
values = c('#FF85A4', '#972D00'),
#values = c("#FFD54E", "#A80002"),
guide = F
) +
labs(
title = 'Драйверы инфляции: <b style="color:#FF85A4">товары</b> или <b style="color:#972D00">услуги</b>?',
subtitle = 'Впервые за долгое время рост цен в России обусловлен дорожанием <b style="color:#972D00">услуг (88%)</b>, нежели <b style="color:#FF85A4">товаров</b>. Иллюстрация того, что <br> российские рынки <b style="color:#FF85A4">товаров</b> реагировали на изменение макроэкономических условий в феврале-марте 2022 г. быстрее, <br> чем рынки <b style="color:#972D00">услуг.</b>.',
caption = 'Е. Тымченко  •  Источник: Росстат'
)  +
theme(
axis.text.x = element_text(color = "grey40", size = 13, face = "bold"),
axis.text.y = element_text(color = "grey40", size = 11, hjust = 0),
panel.grid.major.y = element_line(color = "grey92", size = .5),
plot.background = element_rect(color = "#333333", size = 2, fill = "white"),
plot.margin = margin(20, 50, 20, 60),
plot.title = element_markdown(family = "Merriweather", color = "#333333",
size = 30, face = "bold", hjust = 0.5,
margin = margin(t = 15, b = 10)),
plot.subtitle = element_markdown(color = "grey65", size = 15, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 0, b = -3)),
plot.caption = element_markdown(color = "grey65", size = 10,
hjust = .5, vjust = .5, lineheight = 1.5, family = 'Philosopher',
margin = margin(t = 35, b = 0)),
plot.title.position = "plot"
)
ggsave(here::here("inflation_2.pdf"),
width = 13.8, height = 10.5, device = cairo_pdf)
pdftools::pdf_convert(here::here("inflation_2.pdf"),
format = "png", dpi = 500)
setwd("C:/Users/evgen/econometrics_2023/GGplot visualizations")
library(httr)
library(jsonlite)
