value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
mat <- matrix(values, ncol = length(data_names), byrow = TRUE) %>% as.data.frame()
mat$Region <- rep(Region, length(mat$V1))
listofdfs[[which(r == xpaths_regions)]] <- mat
}
xpaths_years <- c('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[1]/label/span'
)
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
values <- c()
listofdfs <- list()
for (r in xpaths_regions){
values <- c()
button_00 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[1]/div/div[1]/button'))$clickElement()
Sys.sleep(0.5)
Region <- remDr$findElements(using = 'xpath', value = paste0(r))
Region <- unlist(lapply(Region, function(x) x$getElementText()))
button_0 <- remDr$findElement(using = 'xpath', value = paste0(r))$clickElement()
Sys.sleep(0.5)
for (k in xpaths_years){
button_1 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_2 <- button_4 <- remDr$findElement(using = 'xpath', value = paste0(k))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
}
button_10 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_20 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[1]/label/span'))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
mat <- matrix(values, ncol = length(data_names), byrow = TRUE) %>% as.data.frame()
mat$Region <- rep(Region, length(mat$V1))
listofdfs[[which(r == xpaths_regions)]] <- mat
}
# All Regions
xpaths_years
xpaths_years <- c('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[2]/label/span'
)
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
values <- c()
listofdfs <- list()
for (r in xpaths_regions){
values <- c()
button_00 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[1]/div/div[1]/button'))$clickElement()
Sys.sleep(0.5)
Region <- remDr$findElements(using = 'xpath', value = paste0(r))
Region <- unlist(lapply(Region, function(x) x$getElementText()))
button_0 <- remDr$findElement(using = 'xpath', value = paste0(r))$clickElement()
Sys.sleep(0.5)
for (k in xpaths_years){
button_1 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_2 <- button_4 <- remDr$findElement(using = 'xpath', value = paste0(k))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months_12){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
}
button_10 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_20 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[1]/label/span'))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
mat <- matrix(values, ncol = length(data_names), byrow = TRUE) %>% as.data.frame()
mat$Region <- rep(Region, length(mat$V1))
listofdfs[[which(r == xpaths_regions)]] <- mat
}
View(mat)
View(listofdfs)
redo <- c()
for (i in 1:96){
if(length(listofdfs[[i]]$V1) < 163){
redo = c(redo, i)}
}
redo
listofdfs[[1]]$V1
listofdfs[[1]]$V1 %>% length
redo <- c()
for (i in 1:96){
if(length(listofdfs[[i]]$V1) < 15){
redo = c(redo, i)}
}
redo
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
values <- c()
listofdfs_1 <- list()
for (r in xpaths_regions[redo]){
values <- c()
button_00 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[1]/div/div[1]/button'))$clickElement()
Sys.sleep(0.5)
Region <- remDr$findElements(using = 'xpath', value = paste0(r))
Region <- unlist(lapply(Region, function(x) x$getElementText()))
button_0 <- remDr$findElement(using = 'xpath', value = paste0(r))$clickElement()
Sys.sleep(0.5)
for (k in xpaths_years){
button_1 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_2 <- button_4 <- remDr$findElement(using = 'xpath', value = paste0(k))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months_12){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
}
button_10 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_20 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[1]/label/span'))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
mat <- matrix(values, ncol = length(data_names), byrow = TRUE) %>% as.data.frame()
mat$Region <- rep(Region, length(mat$V1))
listofdfs_1[[which(r == xpaths_regions[redo])]] <- mat
}
redo_1 <- c()
for (i in 1:96){
if(length(listofdfs_1[[i]]$V1) < 15){
redo = c(redo, i)}
}
redo_1 <- c()
for (i in 1:length(redo)){
if(length(listofdfs_1[[i]]$V1) < 15){
redo_1 = c(redo_1, i)}
}
listofdfs_1
#
fin <- listofdfs
fin[[30]]
mat
redo
redo %>% length()
which(redo == 1)
which(redo == 2)
fin[[redo]]
fin[[redo[1:2]]]
fin[[redo[1]]]
fin[[redo[c(1,2)]]]
fin[[redo[1]]]
for (i in 1:length(redo)){
fin[[redo[i]]] <- listofdfs_1[[i]]
}
length(listofdfs_1)
red0
redo
#
fin <- listofdfs
for (i in 1:length(listofdfs_1)){
fin[[redo[i]]] <- listofdfs_1[[i]]
}
for (j in 1:96){
fin[[j]]$V7 <- gsub(',', '.', fin[[j]][,7])
fin[[j]]$V8 <- gsub(',', '.', fin[[j]][,8])
fin[[j]]$V9 <- gsub(',', '.', fin[[j]][,9])
fin[[j]]$V11 <- gsub(',', '.', fin[[j]][,11])
fin[[j]]$V12  <- gsub(',', '.', fin[[j]][,12])
fin[[j]]$V14  <- gsub(',', '.', fin[[j]][,14])
for (i in 1:15){
fin[[j]][,i] <- as.numeric(fin[[j]][,i])
}
}
for (j in 1:2){
for (k in 1:6){
f1 <- c()
a <- max(fin[[j]][,k] %>% na.omit()) / 55
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] < a)){
f <- fin[[j]][i,k] * 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
for (j in 1:96){
for (k in 4){
f1 <- c()
a <- min(fin[[j]][,k] %>% na.omit()) * 100
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] > a)){
f <- fin[[j]][i,k] / 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
df_all <- data.frame(V1 = c(),
V2 = c(),
V3 = c(),
V4 = c(),
V5 = c(),
V6 = c(),
V7 = c(),
V7 = c(),
V8 = c(),
V9 = c(),
V10 = c(),
V11 = c(),
V12 = c(),
V13 = c(),
V14 = c(),
V15 = c(),
V16 = c())
fine <- c()
for (i in 1:96){
if(length(fin[[i]]$V1) == 15){
fine = c(fine, i)}
}
fine
first <- c()
for (i in fine){
first <- c(first, fin[[i]]$Region %>% unique())
}
setdiff(unique(df_all$Region), first)
df_all <- data.frame(V1 = c(),
V2 = c(),
V3 = c(),
V4 = c(),
V5 = c(),
V6 = c(),
V7 = c(),
V7 = c(),
V8 = c(),
V9 = c(),
V10 = c(),
V11 = c(),
V12 = c(),
V13 = c(),
V14 = c(),
V15 = c(),
V16 = c())
fin_df <- rbindlist(fin)
View(fin_df)
dates <- seq(as.Date('2022-01-01'), as.Date('2023-03-01'), by = 'month')
redo <- c()
for (i in 1:96){
if(length(fin[[i]][,1]) < 15){
redo = c(redo, i)}
}
redo
remDr$navigate("https://xn--80az8a.xn--d1aqf.xn--p1ai/%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B5_%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5")
values <- c()
listofdfs_3 <- list()
for (r in xpaths_regions[redo]){
values <- c()
button_00 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[1]/div/div[1]/button'))$clickElement()
Sys.sleep(0.5)
Region <- remDr$findElements(using = 'xpath', value = paste0(r))
Region <- unlist(lapply(Region, function(x) x$getElementText()))
button_0 <- remDr$findElement(using = 'xpath', value = paste0(r))$clickElement()
Sys.sleep(0.5)
for (k in xpaths_years){
button_1 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_2 <- button_4 <- remDr$findElement(using = 'xpath', value = paste0(k))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months_12){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
}
button_10 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_20 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[2]/div[2]/div/ul/li[1]/label/span'))$clickElement()
Sys.sleep(0.5)
for (j in xpaths_months){
button_3 <- remDr$findElement(using = 'xpath', value = paste0('//*[@id="base-header"]/div[2]/div[2]/div/div[1]/div[1]/button'))$clickElement()
Sys.sleep(0.5)
button_4 <- remDr$findElement(using = 'xpath', value = paste0(j))$clickElement()
Sys.sleep(3)
for (i in data_xpaths){
path <- remDr$findElements(using = 'xpath', value = paste0(i))
value <- unlist(lapply(path, function(x) x$getElementText()))
value <- sub(' ', '', value, fixed = TRUE)
values <- c(values, value)
}
}
mat <- matrix(values, ncol = length(data_names), byrow = TRUE) %>% as.data.frame()
mat$Region <- rep(Region, length(mat$V1))
listofdfs_3[[which(r == xpaths_regions[redo])]] <- mat
}
fin_1 <- fin
for (i in redo){
fin_1[[i]] <- listofdfs_3[[which(i == redo)]]
}
redo <- c()
for (i in 1:96){
if(length(fin_1[[i]]$V1) < 163){
redo = c(redo, i)}
}
redo
redo <- c()
for (i in 1:96){
if(length(fin_1[[i]]$V1) < 15){
redo = c(redo, i)}
}
redo
fin <- fin_1
for (j in 1:2){
for (k in 1:6){
f1 <- c()
a <- max(fin[[j]][,k] %>% na.omit()) / 55
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] < a)){
f <- fin[[j]][i,k] * 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
for (j in 1:96){
for (k in 4){
f1 <- c()
a <- min(fin[[j]][,k] %>% na.omit()) * 100
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] > a)){
f <- fin[[j]][i,k] / 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
#
fin <- listofdfs
for (i in 1:length(listofdfs_1)){
fin[[redo[i]]] <- listofdfs_1[[i]]
}
#
fin <- listofdfs
for (i in 1:length(listofdfs_1)){
fin[[redo[i]]] <- listofdfs_1[[i]]
}
redo <- c()
for (i in 1:96){
if(length(fin[[i]][,1]) < 15){
redo = c(redo, i)}
}
for (i in 1:length(listofdfs_1)){
fin[[redo[i]]] <- listofdfs_1[[i]]
}
fin_1 <- fin
redo <- c()
for (i in 1:96){
if(length(fin[[i]][,1]) < 15){
redo = c(redo, i)}
}
fin_1 <- fin
for (i in redo){
fin_1[[i]] <- listofdfs_3[[which(i == redo)]]
}
redo <- c()
for (i in 1:96){
if(length(fin_1[[i]]$V1) < 15){
redo = c(redo, i)}
}
redo
fin <- fin_1
for (j in 1:96){
fin[[j]]$V7 <- gsub(',', '.', fin[[j]][,7])
fin[[j]]$V8 <- gsub(',', '.', fin[[j]][,8])
fin[[j]]$V9 <- gsub(',', '.', fin[[j]][,9])
fin[[j]]$V11 <- gsub(',', '.', fin[[j]][,11])
fin[[j]]$V12  <- gsub(',', '.', fin[[j]][,12])
fin[[j]]$V14  <- gsub(',', '.', fin[[j]][,14])
for (i in 1:15){
fin[[j]][,i] <- as.numeric(fin[[j]][,i])
}
}
for (j in 1:2){
for (k in 1:6){
f1 <- c()
a <- max(fin[[j]][,k] %>% na.omit()) / 55
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] < a)){
f <- fin[[j]][i,k] * 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
for (j in 1:96){
for (k in 4){
f1 <- c()
a <- min(fin[[j]][,k] %>% na.omit()) * 100
for (i in 1:length(fin[[j]][,k]))
if(isTRUE(fin[[j]][i,k] > a)){
f <- fin[[j]][i,k] / 1000
f1 <- c(f1, f)
}else{
f = fin[[j]][i,k]
f1 <- c(f1, f)
}
fin[[j]][,k] <- f1
}
}
fine <- c()
for (i in 1:96){
if(length(fin[[i]]$V1) == 15){
fine = c(fine, i)}
}
first <- c()
for (i in fine){
first <- c(first, fin[[i]]$Region %>% unique())
}
fin_df <- rbindlist(fin)
fine
setdiff(unique(df_all$Region), first)
dates <- seq(as.Date('2022-01-01'), as.Date('2023-03-01'), by = 'month')
dates <- rep(dates, length(df_all$V8) / 15)
fin_df$Date <- dates
colnames(fin_df)[1:15] <- data_names[1:15]
View(fin_df)
write.xlsx(fin_df, 'nash_dom_database_2022_2023.xlsx')
library(xlsx)
write.xlsx(fin_df, 'nash_dom_database_2022_2023.xlsx')
df_old <- read.xlsx('nash_dom_database_3.xlsx')
df_old <- read.xlsx('nash_dom_database_3.xlsx', sheetIndex = 1)
setwd("C:/Users/evgen/construction_panel")
df_old <- read.xlsx('nash_dom_database_3.xlsx', sheetIndex = 1)
View(df_old)
df_old <- df_all[-1]
df_old <- read.xlsx('nash_dom_database_3.xlsx', sheetIndex = 1)
df_new <- merge(df_old, fin_df)
View(df_new)
df_new <- read.xlsx('nash_dom_database_2022_2023.xlsx', sheetIndex = 1)
df_old <- read.xlsx('nash_dom_database_3.xlsx', sheetIndex = 1)
